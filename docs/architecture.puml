@startuml src_v4_architecture
top to bottom direction
!theme plain
skinparam packageStyle rectangle
skinparam padding 10
skinparam nodesep 50
skinparam ranksep 50

title FAMAM src_v4 Architecture

' Layer 1
rectangle "client" as client #LightBlue {
    file "cli.py" as cli
    file "menu_cli.py" as menu
}

' Layer 2 - use rectangle for better arrow centering
rectangle "data_preprocessing" as dp #LightYellow {
    file "music_dataset_config.py" as dsc
    package "encoders" as enc {
        file "base_encoder.py"
        file "event_encoder.py"
        file "remi_encoder.py"
        file "multitrack_encoder.py"
    }
    package "pipeline" as dpp {
        file "preprocessing.py"
        file "dataset_builder.py"
    }
}

rectangle "model_training" as mt #LightCoral {
    file "config.py" as mtc
    package "architectures" as arch {
        file "base_model.py"
        file "transformer_model.py"
        file "lstm_model.py"
    }
    package "pipeline" as mtp {
        file "trainer.py"
    }
}

rectangle "music_generation" as mg #Plum {
    file "generator.py"
    file "multitrack_generator.py"
}

' Layer 3
rectangle "core" as core #LightGreen {
    file "vocabulary.py"
    file "music_dataset.py"
    file "model_bundle.py"
}

' Connections using aliases for center alignment
client --down--> dp
client --down--> mt
client --down--> mg

dp --down--> core
mt --down--> core
mg --down--> core

@enduml
